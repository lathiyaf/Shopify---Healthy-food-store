(function(){function n(t,e,i,n){return new r(t,e,i,n)}function r(t,e,i,n){this.options=n||{},this.options.adapters=this.options.adapters||{},this.obj=t,this.keypath=e,this.callback=i,this.objectPath=[],this.update=this.update.bind(this),this.parse(),s(this.target=this.realize())&&this.set(!0,this.key,this.target,this.callback)}function s(t){return"object"==typeof t&&null!==t}function o(t){throw new Error("[sightglass] "+t)}n.adapters={},r.tokenize=function(t,e,i){for(var n,r=[],s={i:i,path:""},o=0;o<t.length;o++)n=t.charAt(o),~e.indexOf(n)?(r.push(s),s={i:n,path:""}):s.path+=n;return r.push(s),r},r.prototype.parse=function(){var t,e,i=this.interfaces();i.length||o("Must define at least one adapter interface."),e=~i.indexOf(this.keypath[0])?(t=this.keypath[0],this.keypath.substr(1)):(void 0===(t=this.options.root||n.root)&&o("Must define a default root adapter."),this.keypath),this.tokens=r.tokenize(e,i,t),this.key=this.tokens.pop()},r.prototype.realize=function(){var i,n=this.obj,r=!1;return this.tokens.forEach(function(t,e){s(n)?(void 0!==this.objectPath[e]?n!==(i=this.objectPath[e])&&(this.set(!1,t,i,this.update),this.set(!0,t,n,this.update),this.objectPath[e]=n):(this.set(!0,t,n,this.update),this.objectPath[e]=n),n=this.get(t,n)):(!1===r&&(r=e),(i=this.objectPath[e])&&this.set(!1,t,i,this.update))},this),!1!==r&&this.objectPath.splice(r),n},r.prototype.update=function(){var t,e;(t=this.realize())!==this.target&&(s(this.target)&&this.set(!1,this.key,this.target,this.callback),s(t)&&this.set(!0,this.key,t,this.callback),e=this.value(),this.target=t,(this.value()instanceof Function||this.value()!==e)&&this.callback())},r.prototype.value=function(){if(s(this.target))return this.get(this.key,this.target)},r.prototype.setValue=function(t){s(this.target)&&this.adapter(this.key).set(this.target,this.key.path,t)},r.prototype.get=function(t,e){return this.adapter(t).get(e,t.path)},r.prototype.set=function(t,e,i,n){t=t?"observe":"unobserve";this.adapter(e)[t](i,e.path,n)},r.prototype.interfaces=function(){var e=Object.keys(this.options.adapters);return Object.keys(n.adapters).forEach(function(t){~e.indexOf(t)||e.push(t)}),e},r.prototype.adapter=function(t){return this.options.adapters[t.i]||n.adapters[t.i]},r.prototype.unobserve=function(){var i;this.tokens.forEach(function(t,e){(i=this.objectPath[e])&&this.set(!1,t,i,this.update)},this),s(this.target)&&this.set(!1,this.key,this.target,this.callback)},"undefined"!=typeof module&&module.exports?module.exports=n:"function"==typeof define&&define.amd?define([],function(){return this.sightglass=n}):this.sightglass=n}).call(this),function(){function y(t,e){return function(){return t.apply(e,arguments)}}function t(t,e){for(var i in e)s.call(e,i)&&(t[i]=e[i]);function n(){this.constructor=t}return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t}var k,n,r,e,f=[].slice,s={}.hasOwnProperty,c=[].indexOf||function(t){for(var e=0,i=this.length;e<i;e++)if(e in this&&this[e]===t)return e;return-1};function i(){}function o(){}function u(t,e,i){var n,r,s,o,u,a,l,h,c,d,p,f,v;for(this.els=t,this.models=e,null==i&&(i={}),this.update=y(this.update,this),this.publish=y(this.publish,this),this.sync=y(this.sync,this),this.unbind=y(this.unbind,this),this.bind=y(this.bind,this),this.select=y(this.select,this),this.traverse=y(this.traverse,this),this.build=y(this.build,this),this.buildBinding=y(this.buildBinding,this),this.bindingRegExp=y(this.bindingRegExp,this),this.options=y(this.options,this),this.els.jquery||this.els instanceof Array||(this.els=[this.els]),u=0,l=(c=k.extensions).length;u<l;u++){if(this[r=c[u]]={},i[r])for(n in d=i[r])s=d[n],this[r][n]=s;for(n in p=k.public[r])s=p[n],null==(o=this[r])[n]&&(o[n]=s)}for(a=0,h=(f=k.options).length;a<h;a++)this[r=f[a]]=null!=(v=i[r])?v:k.public[r];this.build()}function a(t,e,i,n,r){this.view=t,this.el=e,this.type=i,this.keypath=n,this.options=null!=r?r:{},this.getValue=y(this.getValue,this),this.update=y(this.update,this),this.unbind=y(this.unbind,this),this.bind=y(this.bind,this),this.publish=y(this.publish,this),this.sync=y(this.sync,this),this.set=y(this.set,this),this.eventHandler=y(this.eventHandler,this),this.formattedValue=y(this.formattedValue,this),this.parseTarget=y(this.parseTarget,this),this.observe=y(this.observe,this),this.setBinder=y(this.setBinder,this),this.formatters=this.options.formatters||[],this.dependencies=[],this.formatterObservers={},this.model=void 0,this.setBinder()}function l(t,e,i){var n,r,s,o,u,a,l;for(this.view=t,this.el=e,this.type=i,this.unbind=y(this.unbind,this),this.bind=y(this.bind,this),this.locals=y(this.locals,this),this.component=this.view.components[this.type],this.static={},this.observers={},this.upstreamObservers={},r=t.bindingRegExp(),o=0,u=(a=this.el.attributes||[]).length;o<u;o++)n=a[o],r.test(n.name)||(s=this.camelCase(n.name),0<=c.call(null!=(l=this.component.static)?l:[],s)?this.static[s]=n.value:this.observers[s]=n.value)}function h(t,e,i,n,r){this.view=t,this.el=e,this.type=i,this.keypath=n,this.options=null!=r?r:{},this.sync=y(this.sync,this),this.formatters=this.options.formatters||[],this.dependencies=[],this.formatterObservers={}}k={options:["prefix","templateDelimiters","rootInterface","preloadData","handler"],extensions:["binders","formatters","components","adapters"],public:{binders:{},components:{},formatters:{},adapters:{},prefix:"rv",templateDelimiters:["{","}"],rootInterface:".",preloadData:!0,handler:function(t,e,i){return this.call(t,e,i.view.models)},configure:function(t){var e,i,n,r;for(n in null==t&&(t={}),t)if(r=t[n],"binders"===n||"components"===n||"formatters"===n||"adapters"===n)for(i in r)e=r[i],k[n][i]=e;else k.public[n]=r},bind:function(t,e,i){return null==e&&(e={}),null==i&&(i={}),(i=new k.View(t,e,i)).bind(),i},init:function(t,e,i){return null==i&&(i={}),null==e&&(e=document.createElement("div")),t=k.public.components[t],e.innerHTML=t.template.call(this,e),i=t.initialize.call(this,e,i),(i=new k.View(e,i)).bind(),i}}},window.jQuery||window.$?(e="on"in jQuery.prototype?["on","off"]:["bind","unbind"],n=e[0],r=e[1],k.Util={bindEvent:function(t,e,i){return jQuery(t)[n](e,i)},unbindEvent:function(t,e,i){return jQuery(t)[r](e,i)},getInputValue:function(t){t=jQuery(t);return"checkbox"===t.attr("type")?t.is(":checked"):t.val()}}):k.Util={bindEvent:"addEventListener"in window?function(t,e,i){return t.addEventListener(e,i,!1)}:function(t,e,i){return t.attachEvent("on"+e,i)},unbindEvent:"removeEventListener"in window?function(t,e,i){return t.removeEventListener(e,i,!1)}:function(t,e,i){return t.detachEvent("on"+e,i)},getInputValue:function(t){var e,i,n,r;if("checkbox"===t.type)return t.checked;if("select-multiple"!==t.type)return t.value;for(r=[],i=0,n=t.length;i<n;i++)(e=t[i]).selected&&r.push(e.value);return r}},k.TypeParser=(i.types={primitive:0,keypath:1},i.parse=function(t){return/^'.*'$|^".*"$/.test(t)?{type:this.types.primitive,value:t.slice(1,-1)}:"true"===t?{type:this.types.primitive,value:!0}:"false"===t?{type:this.types.primitive,value:!1}:"null"===t?{type:this.types.primitive,value:null}:"undefined"===t?{type:this.types.primitive,value:void 0}:!1===isNaN(Number(t))?{type:this.types.primitive,value:Number(t)}:{type:this.types.keypath,value:t}},i),k.TextTemplateParser=(o.types={text:0,binding:1},o.parse=function(t,e){for(var i,n,r=[],s=t.length,o=0,u=0;u<s;){if((o=t.indexOf(e[0],u))<0){r.push({type:this.types.text,value:t.slice(u)});break}if(0<o&&u<o&&r.push({type:this.types.text,value:t.slice(u,o)}),u=o+e[0].length,(o=t.indexOf(e[1],u))<0){n=t.slice(u-e[1].length),(null!=(i=r[r.length-1])?i.type:void 0)===this.types.text?i.value+=n:r.push({type:this.types.text,value:n});break}n=t.slice(u,o).trim(),r.push({type:this.types.binding,value:n}),u=o+e[1].length}return r},o),k.View=(u.prototype.options=function(){for(var t,e={},i=k.extensions.concat(k.options),n=0,r=i.length;n<r;n++)e[t=i[n]]=this[t];return e},u.prototype.bindingRegExp=function(){return new RegExp("^"+this.prefix+"-")},u.prototype.buildBinding=function(t,e,i,r){var s,o,n={},u=function(){for(var t=r.split("|"),e=[],i=0,n=t.length;i<n;i++)o=t[i],e.push(o.trim());return e}(),a=function(){for(var t=u.shift().split("<"),e=[],i=0,n=t.length;i<n;i++)s=t[i],e.push(s.trim());return e}(),l=a.shift();return n.formatters=u,(a=a.shift())&&(n.dependencies=a.split(/\s+/)),this.bindings.push(new k[t](this,e,i,l,n))},u.prototype.build=function(){var t,v,e,i,n,y;for(this.bindings=[],v=function(r){var t,e,i,s,n,o,u,a,l,h,c,d,p,f;if(3===r.nodeType){if(n=k.TextTemplateParser,(i=y.templateDelimiters)&&(a=n.parse(r.data,i)).length&&(1!==a.length||a[0].type!==n.types.text)){for(l=0,c=a.length;l<c;l++)u=a[l],o=document.createTextNode(u.value),r.parentNode.insertBefore(o,r),1===u.type&&y.buildBinding("TextBinding",o,null,u.value);r.parentNode.removeChild(r)}}else 1===r.nodeType&&(t=y.traverse(r));if(!t){for(f=[],h=0,d=(p=function(){for(var t=r.childNodes,e=[],i=0,n=t.length;i<n;i++)s=t[i],e.push(s);return e}()).length;h<d;h++)e=p[h],f.push(v(e));return f}},e=0,i=(n=(y=this).els).length;e<i;e++)t=n[e],v(t);this.bindings.sort(function(t,e){return((null!=(e=e.binder)?e.priority:void 0)||0)-((null!=(t=t.binder)?t.priority:void 0)||0)})},u.prototype.traverse=function(t){for(var e,i,n,r,s,o,u,a,l,h,c=this.bindingRegExp(),d="SCRIPT"===t.nodeName||"STYLE"===t.nodeName,p=t.attributes,f=0,v=p.length;f<v;f++)if(e=p[f],c.test(e.name)){if(s=e.name.replace(c,""),!(n=this.binders[s]))for(r in l=this.binders)o=l[r],"*"!==r&&-1!==r.indexOf("*")&&new RegExp("^"+r.replace(/\*/g,".+")+"$").test(s)&&(n=o);(n=n||this.binders["*"]).block&&(d=!0,i=[e])}for(u=0,a=(h=i||t.attributes).length;u<a;u++)e=h[u],c.test(e.name)&&(s=e.name.replace(c,""),this.buildBinding("Binding",t,s,e.value));return d||(s=t.nodeName.toLowerCase(),this.components[s]&&!t._bound&&(this.bindings.push(new k.ComponentBinding(this,t,s)),d=!0)),d},u.prototype.select=function(t){for(var e,i=this.bindings,n=[],r=0,s=i.length;r<s;r++)t(e=i[r])&&n.push(e);return n},u.prototype.bind=function(){for(var t,e=this.bindings,i=[],n=0,r=e.length;n<r;n++)t=e[n],i.push(t.bind());return i},u.prototype.unbind=function(){for(var t,e=this.bindings,i=[],n=0,r=e.length;n<r;n++)t=e[n],i.push(t.unbind());return i},u.prototype.sync=function(){for(var t,e=this.bindings,i=[],n=0,r=e.length;n<r;n++)t=e[n],i.push("function"==typeof t.sync?t.sync():void 0);return i},u.prototype.publish=function(){for(var t,e=this.select(function(t){return null!=(t=t.binder)?t.publishes:void 0}),i=[],n=0,r=e.length;n<r;n++)t=e[n],i.push(t.publish());return i},u.prototype.update=function(t){var e,i,n,r,s,o,u;for(i in null==t&&(t={}),t)n=t[i],this.models[i]=n;for(u=[],r=0,s=(o=this.bindings).length;r<s;r++)e=o[r],u.push("function"==typeof e.update?e.update(t):void 0);return u},u),k.Binding=(a.prototype.setBinder=function(){var t,e,i;if(!(this.binder=this.view.binders[this.type]))for(t in i=this.view.binders)e=i[t],"*"!==t&&-1!==t.indexOf("*")&&new RegExp("^"+t.replace(/\*/g,".+")+"$").test(this.type)&&(this.binder=e,this.args=new RegExp("^"+t.replace(/\*/g,"(.+)")+"$").exec(this.type),this.args.shift());if(this.binder||(this.binder=this.view.binders["*"]),this.binder instanceof Function)return this.binder={routine:this.binder}},a.prototype.observe=function(t,e,i){return k.sightglass(t,e,i,{root:this.view.rootInterface,adapters:this.view.adapters})},a.prototype.parseTarget=function(){var t=k.TypeParser.parse(this.keypath);return 0===t.type?this.value=t.value:(this.observer=this.observe(this.view.models,this.keypath,this.sync),this.model=this.observer.target)},a.prototype.formattedValue=function(t){for(var e,n,r,i,s,o,u,a,l,h,c=this.formatters,d=a=0,p=c.length;a<p;d=++a){for(i=c[d],s=(r=i.match(/[^\s']+|'([^']|'[^\s])*'|"([^"]|"[^\s])*"/g)).shift(),i=this.view.formatters[s],o=[],e=l=0,h=(r=function(){for(var t=[],e=0,i=r.length;e<i;e++)n=r[e],t.push(k.TypeParser.parse(n));return t}()).length;l<h;e=++l)n=r[e],o.push(0===n.type?n.value:((u=this.formatterObservers)[d]||(u[d]={}),(u=this.formatterObservers[d][e])||(u=this.observe(this.view.models,n.value,this.sync),this.formatterObservers[d][e]=u),u.value()));(null!=i?i.read:void 0)instanceof Function?t=i.read.apply(i,[t].concat(f.call(o))):i instanceof Function&&(t=i.apply(null,[t].concat(f.call(o))))}return t},a.prototype.eventHandler=function(e){var i,n=(i=this).view.handler;return function(t){return n.call(e,this,t,i)}},a.prototype.set=function(t){var e;return t=t instanceof Function&&!this.binder.function?this.formattedValue(t.call(this.model)):this.formattedValue(t),null!=(e=this.binder.routine)?e.call(this,this.el,t):void 0},a.prototype.sync=function(){var u,a;return this.set(function(){var t,e,i,n,r,s,o;if(this.observer){if(this.model!==this.observer.target){for(t=0,i=(r=this.dependencies).length;t<i;t++)(a=r[t]).unobserve();if(this.dependencies=[],null!=(this.model=this.observer.target)&&null!=(s=this.options.dependencies)&&s.length)for(e=0,n=(o=this.options.dependencies).length;e<n;e++)u=o[e],a=this.observe(this.model,u,this.sync),this.dependencies.push(a)}return this.observer.value()}return this.value}.call(this))},a.prototype.publish=function(){var t,e,i,n,r,s,o;if(this.observer){for(e=this.getValue(this.el),i=0,n=(r=this.formatters.slice(0).reverse()).length;i<n;i++)o=(t=r[i].split(/\s+/)).shift(),null!=(s=this.view.formatters[o])&&s.publish&&(e=(o=this.view.formatters[o]).publish.apply(o,[e].concat(f.call(t))));return this.observer.setValue(e)}},a.prototype.bind=function(){var t,e,i,n,r,s;if(this.parseTarget(),null!=(n=this.binder.bind)&&n.call(this,this.el),null!=this.model&&null!=(r=this.options.dependencies)&&r.length)for(e=0,i=(s=this.options.dependencies).length;e<i;e++)t=s[e],t=this.observe(this.model,t,this.sync),this.dependencies.push(t);if(this.view.preloadData)return this.sync()},a.prototype.unbind=function(){var t,e,i,n,r,s,o,u;for(null!=(s=this.binder.unbind)&&s.call(this,this.el),null!=(s=this.observer)&&s.unobserve(),n=0,r=(o=this.dependencies).length;n<r;n++)o[n].unobserve();for(i in this.dependencies=[],u=this.formatterObservers)for(t in e=u[i])e[t].unobserve();return this.formatterObservers={}},a.prototype.update=function(t){var e;return null==t&&(t={}),this.model=null!=(e=this.observer)?e.target:void 0,null!=(e=this.binder.update)?e.call(this,t):void 0},a.prototype.getValue=function(t){return this.binder&&null!=this.binder.getValue?this.binder.getValue.call(this,t):k.Util.getInputValue(t)},a),k.ComponentBinding=(e=k.Binding,t(l,e),l.prototype.sync=function(){},l.prototype.update=function(){},l.prototype.publish=function(){},l.prototype.locals=function(){var t,e,i,n,r={},s=this.static;for(t in s)i=s[t],r[t]=i;for(t in n=this.observers)e=n[t],r[t]=e.value();return r},l.prototype.camelCase=function(t){return t.replace(/-([a-z])/g,function(t){return t[1].toUpperCase()})},l.prototype.bind=function(){var t,e,i,n,r,s,o,u,a,l,h,c,d,p,f,v,y,b,m,g,w;if(!this.bound){for(e in p=this.observers)i=p[e],this.observers[e]=this.observe(this.view.models,i,function(e){return function(t){return function(){return e.componentView.models[t]=e.observers[t].value()}}}(this).call(this,e));this.bound=!0}if(null!=this.componentView)return this.componentView.bind();for(this.el.innerHTML=this.component.template.call(this),o=this.component.initialize.call(this,this.el,this.locals()),this.el._bound=!0,s={},l=0,c=(f=k.extensions).length;l<c;l++){if(s[r=f[l]]={},this.component[r])for(t in v=this.component[r])u=v[t],s[r][t]=u;for(t in y=this.view[r])u=y[t],null==(a=s[r])[t]&&(a[t]=u)}for(h=0,d=(b=k.options).length;h<d;h++)s[r=b[h]]=null!=(m=this.component[r])?m:this.view[r];for(e in this.componentView=new k.View(this.el,o,s),this.componentView.bind(),w=[],g=this.observers)n=g[e],w.push(this.upstreamObservers[e]=this.observe(this.componentView.models,e,function(i){return function(t,e){return function(){return e.setValue(i.componentView.models[t])}}}(this).call(this,e,n)));return w},l.prototype.unbind=function(){var t,e,i,n=this.upstreamObservers;for(t in n)n[t].unobserve();for(t in e=this.observers)e[t].unobserve();return null!=(i=this.componentView)?i.unbind.call(this):void 0},l),k.TextBinding=(e=k.Binding,t(h,e),h.prototype.binder={routine:function(t,e){return t.data=null!=e?e:""}},h.prototype.sync=function(){return h.__super__.sync.apply(this,arguments)},h),k.public.binders.text=function(t,e){return null!=t.textContent?t.textContent=null!=e?e:"":t.innerText=null!=e?e:""},k.public.binders.html=function(t,e){return t.innerHTML=null!=e?e:""},k.public.binders.show=function(t,e){return t.style.display=e?"":"none"},k.public.binders.hide=function(t,e){return t.style.display=e?"none":""},k.public.binders.enabled=function(t,e){return t.disabled=!e},k.public.binders.disabled=function(t,e){return t.disabled=!!e},k.public.binders.checked={publishes:!0,priority:2e3,bind:function(t){return k.Util.bindEvent(t,"change",this.publish)},unbind:function(t){return k.Util.unbindEvent(t,"change",this.publish)},routine:function(t,e){var i;return"radio"===t.type?t.checked=(null!=(i=t.value)?i.toString():void 0)===(null!=e?e.toString():void 0):t.checked=!!e}},k.public.binders.unchecked={publishes:!0,priority:2e3,bind:function(t){return k.Util.bindEvent(t,"change",this.publish)},unbind:function(t){return k.Util.unbindEvent(t,"change",this.publish)},routine:function(t,e){var i;return"radio"===t.type?t.checked=(null!=(i=t.value)?i.toString():void 0)!==(null!=e?e.toString():void 0):t.checked=!e}},k.public.binders.value={publishes:!0,priority:3e3,bind:function(t){if("INPUT"!==t.tagName||"radio"!==t.type)return this.event="SELECT"===t.tagName?"change":"input",k.Util.bindEvent(t,this.event,this.publish)},unbind:function(t){if("INPUT"!==t.tagName||"radio"!==t.type)return k.Util.unbindEvent(t,this.event,this.publish)},routine:function(t,e){var i,n,r,s,o;if("INPUT"===t.tagName&&"radio"===t.type)return t.setAttribute("value",e);if(null!=window.jQuery){if(t=jQuery(t),(null!=e?e.toString():void 0)!==(null!=(s=t.val())?s.toString():void 0))return t.val(null!=e?e:"")}else if("select-multiple"===t.type){if(null!=e){for(o=[],i=0,n=t.length;i<n;i++)r=t[i],o.push(r.selected=(r=r.value,0<=c.call(e,r)));return o}}else if((null!=e?e.toString():void 0)!==(null!=(s=t.value)?s.toString():void 0))return t.value=null!=e?e:""}},k.public.binders.if={block:!0,priority:4e3,bind:function(t){var e,i;if(null==this.marker)return e=[this.view.prefix,this.type].join("-").replace("--","-"),i=t.getAttribute(e),this.marker=document.createComment(" rivets: "+this.type+" "+i+" "),this.bound=!1,t.removeAttribute(e),t.parentNode.insertBefore(this.marker,t),t.parentNode.removeChild(t)},unbind:function(){var t;return null!=(t=this.nested)?t.unbind():void 0},routine:function(t,e){var i,n,r,s;if(!!e==!this.bound){if(e){for(i in r={},s=this.view.models)n=s[i],r[i]=n;return(this.nested||(this.nested=new k.View(t,r,this.view.options()))).bind(),this.marker.parentNode.insertBefore(t,this.marker.nextSibling),this.bound=!0}return t.parentNode.removeChild(t),this.nested.unbind(),this.bound=!1}},update:function(t){var e;return null!=(e=this.nested)?e.update(t):void 0}},k.public.binders.unless={block:!0,priority:4e3,bind:function(t){return k.public.binders.if.bind.call(this,t)},unbind:function(){return k.public.binders.if.unbind.call(this)},routine:function(t,e){return k.public.binders.if.routine.call(this,t,!e)},update:function(t){return k.public.binders.if.update.call(this,t)}},k.public.binders["on-*"]={function:!0,priority:1e3,unbind:function(t){if(this.handler)return k.Util.unbindEvent(t,this.args[0],this.handler)},routine:function(t,e){return this.handler&&k.Util.unbindEvent(t,this.args[0],this.handler),k.Util.bindEvent(t,this.args[0],this.handler=this.eventHandler(e))}},k.public.binders["each-*"]={block:!0,priority:4e3,bind:function(t){var e,i,n,r;if(null==this.marker)e=[this.view.prefix,this.type].join("-").replace("--","-"),this.marker=document.createComment(" rivets: "+this.type+" "),this.iterated=[],t.removeAttribute(e),t.parentNode.insertBefore(this.marker,t),t.parentNode.removeChild(t);else for(i=0,n=(r=this.iterated).length;i<n;i++)r[i].bind()},unbind:function(t){var e,i,n,r,s;if(null!=this.iterated){for(s=[],i=0,n=(r=this.iterated).length;i<n;i++)e=r[i],s.push(e.unbind());return s}},routine:function(t,e){var i,n,r,s,o,u,a,l,h,c,d,p,f,v,y,b,m,g,w,C=this.args[0];if(e=e||[],this.iterated.length>e.length)for(c=0,f=(b=Array(this.iterated.length-e.length)).length;c<f;c++)b[c],(h=this.iterated.pop()).unbind(),this.marker.parentNode.removeChild(h.els[0]);for(r=d=0,v=e.length;d<v;r=++d)if(o=e[r],(n={index:r})[C]=o,null==this.iterated[r]){for(s in m=this.view.models)o=m[s],null==n[s]&&(n[s]=o);a=this.iterated.length?this.iterated[this.iterated.length-1].els[0]:this.marker,(u=this.view.options()).preloadData=!0,l=t.cloneNode(!0),(h=new k.View(l,n,u)).bind(),this.iterated.push(h),this.marker.parentNode.insertBefore(l,a.nextSibling)}else this.iterated[r].models[C]!==o&&this.iterated[r].update(n);if("OPTION"===t.nodeName){for(w=[],p=0,y=(g=this.view.bindings).length;p<y;p++)(i=g[p]).el===this.marker.parentNode&&"value"===i.type?w.push(i.sync()):w.push(void 0);return w}},update:function(t){var e,i,n,r,s,o,u,a={};for(e in t)i=t[e],e!==this.args[0]&&(a[e]=i);for(u=[],r=0,s=(o=this.iterated).length;r<s;r++)n=o[r],u.push(n.update(a));return u}},k.public.binders["class-*"]=function(t,e){var i=" "+t.className+" ";if(!e==(-1!==i.indexOf(" "+this.args[0]+" ")))return t.className=e?t.className+" "+this.args[0]:i.replace(" "+this.args[0]+" "," ").trim()},k.public.binders["*"]=function(t,e){return null!=e?t.setAttribute(this.type,e):t.removeAttribute(this.type)},k.public.adapters["."]={id:"_rv",counter:0,weakmap:{},weakReference:function(t){var e;return t.hasOwnProperty(this.id)||(e=this.counter++,Object.defineProperty(t,this.id,{value:e})),(e=this.weakmap)[t=t[this.id]]||(e[t]={callbacks:{}})},cleanupWeakReference:function(t,e){if(!(Object.keys(t.callbacks).length||t.pointers&&Object.keys(t.pointers).length))return delete this.weakmap[e]},stubFunction:function(a,t){var l=a[t],h=this.weakReference(a),c=this.weakmap;return a[t]=function(){var t,e,i,n,r,s,o=l.apply(a,arguments),u=h.pointers;for(t in u)for(n=u[t],e=0,i=(s=null!=(n=null!=(r=c[t])?r.callbacks[n]:void 0)?n:[]).length;e<i;e++)(0,s[e])();return o}},observeMutations:function(t,e,i){var n,r,s,o,u,a;if(Array.isArray(t)){if(null==(s=this.weakReference(t)).pointers)for(s.pointers={},u=0,a=(r=["push","pop","shift","unshift","sort","reverse","splice"]).length;u<a;u++)n=r[u],this.stubFunction(t,n);if(null==(o=s.pointers)[e]&&(o[e]=[]),c.call(s.pointers[e],i)<0)return s.pointers[e].push(i)}},unobserveMutations:function(t,e,i){var n,r;if(Array.isArray(t)&&null!=t[this.id]&&(n=this.weakmap[t[this.id]])&&(r=n.pointers[e]))return 0<=(i=r.indexOf(i))&&r.splice(i,1),r.length||delete n.pointers[e],this.cleanupWeakReference(n,t[this.id])},observe:function(s,o,u){var t,a,l,h=this.weakReference(s).callbacks;return null==h[o]&&(h[o]=[],null!=(t=Object.getOwnPropertyDescriptor(s,o))&&t.get||null!=t&&t.set||(a=s[o],Object.defineProperty(s,o,{enumerable:!0,get:function(){return a},set:(l=this,function(t){var e,i,n,r;if(t!==a&&(l.unobserveMutations(a,s[l.id],o),a=t,e=l.weakmap[s[l.id]])){if((h=e.callbacks)[o])for(i=0,n=(r=h[o].slice()).length;i<n;i++)u=r[i],0<=c.call(h[o],u)&&u();return l.observeMutations(t,s[l.id],o)}})}))),c.call(h[o],u)<0&&h[o].push(u),this.observeMutations(s[o],s[this.id],o)},unobserve:function(t,e,i){var n,r;if((r=this.weakmap[t[this.id]])&&(n=r.callbacks[e]))return 0<=(i=n.indexOf(i))&&(n.splice(i,1),n.length||delete r.callbacks[e]),this.unobserveMutations(t[e],t[this.id],e),this.cleanupWeakReference(r,t[this.id])},get:function(t,e){return t[e]},set:function(t,e,i){return t[e]=i}},k.factory=function(t){return k.sightglass=t,(k.public._=k).public},"object"==typeof("undefined"!=typeof module&&null!==module?module.exports:void 0)?module.exports=k.factory(require("sightglass")):"function"==typeof define&&define.amd?define(["sightglass"],function(t){return this.rivets=k.factory(t)}):this.rivets=k.factory(sightglass)}.call(this),function(){function e(t,e){return function(){return t.apply(e,arguments)}}var i,t,s,o,n,r,u=[].indexOf||function(t){for(var e=0,i=this.length;e<i;e++)if(e in this&&this[e]===t)return e;return-1};function a(){this.update=e(this.update,this)}function l(t){this.propertyArray=e(this.propertyArray,this),this.update=e(this.update,this),this.update(t)}a.prototype.update=function(r){var s,t,e;for(t in r)e=r[t],"items"!==t&&(this[t]=e);return this.items=function(){for(var t=r.items,e=[],i=0,n=t.length;i<n;i++)s=t[i],e.push(new o(s));return e}()},t=a,l.prototype.update=function(t){var e,i;for(e in t)i=t[e],"properties"!==e&&(this[e]=i);return this.properties=s.Utils.extend({},t.properties)},l.prototype.propertyArray=function(){var t,e,i=this.properties,n=[];for(t in i)e=i[t],n.push({name:t,value:e});return n},o=l,s={settings:{debug:!1,dataAPI:!0,requestBodyClass:null,rivetsModels:{},currency:null,moneyFormat:null,moneyWithCurrencyFormat:null,weightUnit:"g",weightPrecision:0},cart:new t,init:function(t,e){return null==e&&(e={}),s.configure(e),s.Utils.log("Initialising CartJS."),s.cart.update(t),s.settings.dataAPI&&(s.Utils.log('"dataAPI" setting is true, initialising Data API.'),s.Data.init()),s.settings.requestBodyClass&&(s.Utils.log('"requestBodyClass" set, adding event listeners.'),jQuery(document).on("cart.requestStarted",function(){return jQuery("body").addClass(s.settings.requestBodyClass)}),jQuery(document).on("cart.requestComplete",function(){return jQuery("body").removeClass(s.settings.requestBodyClass)})),s.Rivets.init(),jQuery(document).trigger("cart.ready",[s.cart])},configure:function(t){return null==t&&(t={}),s.Utils.extend(s.settings,t)}},null==window.console&&(window.console={},window.console.log=function(){}),s.Utils={log:function(){return s.Utils.console(console.log,arguments)},warn:function(){return s.Utils.console(console.warn,arguments)},error:function(){return s.Utils.console(console.error,arguments)},console:function(t,e){if(s.settings.debug&&"undefined"!=typeof console&&null!==console)return(e=Array.prototype.slice.call(e)).unshift("[CartJS]:"),t.apply(console,e)},wrapKeys:function(t,e,i,n){var r,s,o;for(r in null==e&&(e="properties"),null==n&&(n=[]),o={},t)s=t[r],o[0<=u.call(n,r)?r:e+"["+r+"]"]=null!=i?i:s;return o},unwrapKeys:function(t,e,i){var n,r,s;for(n in null==e&&(e="properties"),r={},t)s=t[n],r[n.replace(e+"[","").replace("]","")]=null!=i?i:s;return r},extend:function(t,e){var i,n;for(i in e)n=e[i],t[i]=n;return t},clone:function(t){var e,i;if(null==t||"object"!=typeof t)return t;for(e in i=new t.constructor,t)i[e]=clone(t[e]);return i},delete:function(t,e){var i=t[e];return delete t[e],i},isArray:Array.isArray||function(t){return"[object Array]"==={}.toString.call(t)},ensureArray:function(t){return s.Utils.isArray(t)?t:null!=t?[t]:[]},formatMoney:function(t,e,i,n){var r;return null==n&&(n=""),n=n||s.settings.currency,null!=window.Currency&&n!==s.settings.currency&&(t=Currency.convert(t,s.settings.currency,n),null!=(null!=(r=window.Currency)?r.moneyFormats:void 0)&&n in window.Currency.moneyFormats&&(e=window.Currency.moneyFormats[n][i])),null!=(null!=(i=window.Shopify)?i.formatMoney:void 0)?Shopify.formatMoney(t,e):(s.Utils.warn('A money formatting filter was used, but Shopify.formatMoney is not available. See the note "Dependency when formatting monetary values" on this page: https://cartjs.org/pages/guide#getting-started-setup.'),t)},getSizedImageUrl:function(t,e){var i,n;return null!=(null!=(i=window.Shopify)&&null!=(n=i.Image)?n.getSizedImageUrl:void 0)?t?Shopify.Image.getSizedImageUrl(t,e):Shopify.Image.getSizedImageUrl("https://cdn.shopify.com/s/images/admin/no-image-.gif",e).replace("-_","-"):t||"https://cdn.shopify.com/s/images/admin/no-image-large.gif"}},n=!(r=[]),s.Queue={add:function(t,e,i){if(null==i&&(i={}),e={url:t,data:e,type:i.type||"POST",dataType:i.dataType||"json",cache:!!i.cache,success:s.Utils.ensureArray(i.success),error:s.Utils.ensureArray(i.error),complete:s.Utils.ensureArray(i.complete)},i.updateCart&&e.success.push(s.cart.update),r.push(e),!n)return jQuery(document).trigger("cart.requestStarted",[s.cart]),s.Queue.process()},process:function(){var t;return r.length?(n=!0,(t=r.shift()).complete=s.Queue.process,jQuery.ajax(t)):(n=!1,void jQuery(document).trigger("cart.requestComplete",[s.cart]))}},s.Core={getCart:function(t){return null==t&&(t={}),t.type="GET",t.updateCart=!0,s.Queue.add("/cart.js",{v:(new Date).getTime()},t)},addItem:function(t,e,i,n){return null==e&&(e=1),null==i&&(i={}),null==n&&(n={}),(i=s.Utils.wrapKeys(i,null,null,["selling_plan"])).id=t,i.quantity=e,s.Queue.add("/cart/add.js",i,n),s.Core.getCart()},addItems:function(t,e){return null==e&&(e={}),t={items:t},s.Queue.add("/cart/add.js",t,e),s.Core.getCart()},updateItem:function(t,e,i,n){return null==i&&(i={}),null==n&&(n={}),(i=s.Utils.wrapKeys(i,null,null,["selling_plan"])).line=t,null!=e&&(i.quantity=e),n.updateCart=!0,s.Queue.add("/cart/change.js",i,n)},removeItem:function(t,e){return null==e&&(e={}),s.Core.updateItem(t,0,{},e)},updateItemById:function(t,e,i,n){return null==i&&(i={}),null==n&&(n={}),(i=s.Utils.wrapKeys(i,null,null,["selling_plan"])).id=t,null!=e&&(i.quantity=e),n.updateCart=!0,s.Queue.add("/cart/change.js",i,n)},updateItemQuantitiesById:function(t,e){return null==t&&(t={}),null==e&&(e={}),e.updateCart=!0,s.Queue.add("/cart/update.js",{updates:t},e)},removeItemById:function(t,e){return null==e&&(e={}),t={id:t,quantity:0},e.updateCart=!0,s.Queue.add("/cart/change.js",t,e)},clear:function(t){return null==t&&(t={}),t.updateCart=!0,s.Queue.add("/cart/clear.js",{},t)},getAttribute:function(t,e){return t in s.cart.attributes?s.cart.attributes[t]:e},setAttribute:function(t,e,i){var n;return null==i&&(i={}),(n={})[t]=e,s.Core.setAttributes(n,i)},getAttributes:function(){return s.cart.attributes},setAttributes:function(t,e){return null==t&&(t={}),null==e&&(e={}),e.updateCart=!0,s.Queue.add("/cart/update.js",s.Utils.wrapKeys(t,"attributes"),e)},clearAttributes:function(t){return null==t&&(t={}),t.updateCart=!0,s.Queue.add("/cart/update.js",s.Utils.wrapKeys(s.Core.getAttributes(),"attributes",""),t)},getNote:function(){return s.cart.note},setNote:function(t,e){return null==e&&(e={}),e.updateCart=!0,s.Queue.add("/cart/update.js",{note:t},e)}},i=null,s.Data={init:function(){return i=jQuery(document),s.Data.setEventListeners("on"),s.Data.render(null,s.cart)},destroy:function(){return s.Data.setEventListeners("off")},setEventListeners:function(t){return i[t]("click","[data-cart-add]",s.Data.add),i[t]("click","[data-cart-remove]",s.Data.remove),i[t]("click","[data-cart-remove-id]",s.Data.removeById),i[t]("click","[data-cart-update]",s.Data.update),i[t]("click","[data-cart-update-id]",s.Data.updateById),i[t]("click","[data-cart-clear]",s.Data.clear),i[t]("change","[data-cart-toggle]",s.Data.toggle),i[t]("change","[data-cart-toggle-attribute]",s.Data.toggleAttribute),i[t]("submit","[data-cart-submit]",s.Data.submit),i[t]("cart.requestComplete",s.Data.render)},add:function(t){var e;return t.preventDefault(),e=jQuery(this),(t={}).selling_plan=e.attr("data-cart-selling-plan"),s.Core.addItem(e.attr("data-cart-add"),e.attr("data-cart-quantity"),t)},remove:function(t){return t.preventDefault(),t=jQuery(this),s.Core.removeItem(t.attr("data-cart-remove"))},removeById:function(t){return t.preventDefault(),t=jQuery(this),s.Core.removeItemById(t.attr("data-cart-remove-id"))},update:function(t){var e;return t.preventDefault(),e=jQuery(this),(t={}).selling_plan=e.attr("data-cart-selling-plan"),s.Core.updateItem(e.attr("data-cart-update"),e.attr("data-cart-quantity"),t)},updateById:function(t){var e;return t.preventDefault(),e=jQuery(this),(t={}).selling_plan=e.attr("data-cart-selling-plan"),s.Core.updateItemById(e.attr("data-cart-update-id"),e.attr("data-cart-quantity"),t)},clear:function(t){return t.preventDefault(),s.Core.clear()},toggle:function(t){var e=jQuery(this),i=e.attr("data-cart-toggle");return e.is(":checked")?s.Core.addItem(i):s.Core.removeItemById(i)},toggleAttribute:function(t){var e=jQuery(this),i=e.attr("data-cart-toggle-attribute");return s.Core.setAttribute(i,e.is(":checked")?"Yes":"")},submit:function(t){var i,n,r;return t.preventDefault(),t=jQuery(this).serializeArray(),r=i=void 0,n={},jQuery.each(t,function(t,e){return"id"===e.name?i=e.value:"quantity"===e.name?r=e.value:"selling_plan"===e.name?n.selling_plan=e.value:e.name.match(/^properties\[[\w-_ ]*\]$/)?n[e.name]=e.value:void 0}),s.Core.addItem(i,r,s.Utils.unwrapKeys(n))},render:function(t,e){var i={item_count:e.item_count,total_price:e.total_price,total_price_money:s.Utils.formatMoney(e.total_price,s.settings.moneyFormat,"money_format",null!=("undefined"!=typeof Currency&&null!==Currency?Currency.currentCurrency:void 0)?Currency.currentCurrency:void 0),total_price_money_with_currency:s.Utils.formatMoney(e.total_price,s.settings.moneyWithCurrencyFormat,"money_with_currency_format",null!=("undefined"!=typeof Currency&&null!==Currency?Currency.currentCurrency:void 0)?Currency.currentCurrency:void 0)};return jQuery("[data-cart-render]").each(function(){var t=jQuery(this);return t.html(i[t.attr("data-cart-render")])})}},"undefined"!=typeof rivets&&null!==rivets?(s.Rivets={model:null,boundViews:[],init:function(){return s.Rivets.bindViews()},destroy:function(){return s.Rivets.unbindViews()},bindViews:function(){return s.Utils.log("Rivets.js is present, binding views."),s.Rivets.unbindViews(),s.Rivets.model=s.Utils.extend({cart:s.cart},s.settings.rivetsModels),null!=window.Currency&&(s.Rivets.model.Currency=window.Currency),jQuery("[data-cart-view]").each(function(){var t=rivets.bind(jQuery(this),s.Rivets.model);return s.Rivets.boundViews.push(t)})},unbindViews:function(){for(var t=s.Rivets.boundViews,e=0,i=t.length;e<i;e++)t[e].unbind();return s.Rivets.boundViews=[]}},rivets.formatters.eq=function(t,e){return t===e},rivets.formatters.includes=function(t,e){return 0<=t.indexOf(e)},rivets.formatters.match=function(t,e,i){return t.match(new RegExp(e,i))},rivets.formatters.lt=function(t,e){return t<e},rivets.formatters.gt=function(t,e){return e<t},rivets.formatters.not=function(t){return!t},rivets.formatters.empty=function(t){return!t.length},rivets.formatters.plus=function(t,e){return parseInt(t)+parseInt(e)},rivets.formatters.minus=function(t,e){return parseInt(t)-parseInt(e)},rivets.formatters.times=function(t,e){return t*e},rivets.formatters.divided_by=function(t,e){return t/e},rivets.formatters.modulo=function(t,e){return t%e},rivets.formatters.prepend=function(t,e){return e+t},rivets.formatters.append=function(t,e){return t+e},rivets.formatters.slice=function(t,e,i){return t.slice(e,i)},rivets.formatters.pluralize=function(t,e,i){return null==i&&(i=e+"s"),s.Utils.isArray(t)&&(t=t.length),1===t?e:i},rivets.formatters.array_element=function(t,e){return t[e]},rivets.formatters.array_first=function(t){return t[0]},rivets.formatters.array_last=function(t){return t[t.length-1]},rivets.formatters.money=function(t,e){return s.Utils.formatMoney(t,s.settings.moneyFormat,"money_format",e)},rivets.formatters.money_with_currency=function(t,e){return s.Utils.formatMoney(t,s.settings.moneyWithCurrencyFormat,"money_with_currency_format",e)},rivets.formatters.weight=function(t){switch(s.settings.weightUnit){case"kg":return(t/1e3).toFixed(s.settings.weightPrecision);case"oz":return(.035274*t).toFixed(s.settings.weightPrecision);case"lb":return(.00220462*t).toFixed(s.settings.weightPrecision);default:return t.toFixed(s.settings.weightPrecision)}},rivets.formatters.weight_with_unit=function(t){return rivets.formatters.weight(t)+s.settings.weightUnit},rivets.formatters.product_image_size=function(t,e){return s.Utils.getSizedImageUrl(t,e)},rivets.formatters.moneyWithCurrency=rivets.formatters.money_with_currency,rivets.formatters.weightWithUnit=rivets.formatters.weight_with_unit,rivets.formatters.productImageSize=rivets.formatters.product_image_size):s.Rivets={init:function(){},destroy:function(){}},s.factory=function(t){return t.init=s.init,t.configure=s.configure,t.cart=s.cart,t.settings=s.settings,t.getCart=s.Core.getCart,t.addItem=s.Core.addItem,t.addItems=s.Core.addItems,t.updateItem=s.Core.updateItem,t.updateItemById=s.Core.updateItemById,t.updateItemQuantitiesById=s.Core.updateItemQuantitiesById,t.removeItem=s.Core.removeItem,t.removeItemById=s.Core.removeItemById,t.clear=s.Core.clear,t.getAttribute=s.Core.getAttribute,t.setAttribute=s.Core.setAttribute,t.getAttributes=s.Core.getAttributes,t.setAttributes=s.Core.setAttributes,t.clearAttributes=s.Core.clearAttributes,t.getNote=s.Core.getNote,t.setNote=s.Core.setNote,t.render=s.Data.render},"object"==typeof exports?s.factory(exports):"function"==typeof define&&define.amd?define(["exports"],function(t){return s.factory(this.CartJS=t),t}):s.factory(this.CartJS={})}.call(this);