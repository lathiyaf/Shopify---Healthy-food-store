<div id="offcanvas-right" class="c-offcanvas c-offcanvas--right" aria-hidden="true">
    <div class="c-cart c-drawer">
        <div class="c-drawer__header">
            <h4 class="c-drawer__title">{{ 'cart_drawer.general.title' | t }} </h4>
            <span class="c-offcanvas__close c-drawer__close" aria-label="Close Menu" aria-hidden="true">
                <svg width="20" height="20" viewBox="0 0 30 30" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M15 0C6.70945 0 0 6.70881 0 15C0 23.2906 6.70881 30 15 30C23.2905 30 30 23.2912 30 15C30 6.70939 23.2912 0 15 0ZM15 27.6562C8.00484 27.6562 2.34375 21.9957 2.34375 15C2.34375 8.00478 8.00432 2.34375 15 2.34375C21.9952 2.34375 27.6562 8.00432 27.6562 15C27.6562 21.9952 21.9957 27.6562 15 27.6562Z" fill="#2C2D32"/>
                    <path d="M20.1322 18.4749L16.6574 15.0002L20.1322 11.5254C20.5898 11.0678 20.5898 10.3258 20.1322 9.86816C19.6745 9.41048 18.9325 9.41054 18.475 9.86816L15.0002 13.3429L11.5254 9.86816C11.0678 9.41048 10.3257 9.41048 9.86813 9.86816C9.41051 10.3258 9.41051 11.0678 9.86819 11.5254L13.3429 15.0002L9.86819 18.4749C9.41051 18.9326 9.41045 19.6745 9.86813 20.1321C10.3259 20.5899 11.0679 20.5897 11.5254 20.1321L15.0002 16.6574L18.475 20.1321C18.9325 20.5898 19.6745 20.5898 20.1322 20.1321C20.5899 19.6745 20.5898 18.9325 20.1322 18.4749Z" fill="#2C2D32"/>
                </svg>
            </span>
        </div>
        
        <form action="/cart" class="addtocart-form" novalidate method="post">
            <span data-cart-render=""></span>
            <div id="" class="c-drawer__body" data-cart-view="data-cart-view" rules="all">
                <div class="c-cart__productList">
                    <div rv-each-item="cart.items" class="c-cart__product" rv-product-handle="item.product.handle" rv-variant-id="item.variant_id" product-variant-id="item.variant_id" rv-data-random="item.random">
                        <div class="c-cart__row c-drawer__item">
                            <div class="c-cart__itemImageBox c-drawer__itemImg">
                                <img rv-src="item.image" rv-alt="item.variant_title">
                            </div>
                            <div class="c-cart__itemInfoBox c-drawer__itemDesc">
                                <h2 rv-html="item.product_title | cname" class="c-cart__itemName c-drawer__itemName"></h2>
                                <p class="mb-2 variant_title_drawer" rv-html="item.variant_title | cname"></p>
                                <p class="mb-2 variant_title_drawer" rv-html="item.selling_plan_allocation.selling_plan.name | cname"></p>
                                
                                <div rv-each-discount="item.discounts" rv-hide="item.discounts | empty" class="c-cart__itemDiscountBox">
                                    <span rv-text="discount.title" class="c-cart__itemDiscount"></span>
                                </div>
                                <div class="c-cart__itemLowerBox" rv-if="item.final_line_price">
                                    <div class="c-cart__itemPriceBox c-drawer__itemPrice">
                                        <span class="c-cart__itemPrice" rv-html="item.final_line_price | money Currency.currentCurrency" class="c-cart__itemPrice">
                                        </span>
                                    </div>
                                    <span class="c-cart__itemRemove" rv-data-id="item.key" product-data-id="item.key" rv-data-cart-remove-id="item.key" >
                                        {% comment %}
                                        <svg width="12px" height="12px" viewBox="0 0 12 12" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                                            <!-- Generator: Sketch 53.2 (72643) - https://sketchapp.com -->
                                            <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                                                <g id="cart-slide-in-CL--subscription" transform="translate(-343.000000, -225.000000)" fill="#3D3D38" fill-rule="nonzero">
                                                    <g id="the-good-sample" transform="translate(30.000000, 225.000000)">
                                                        <g id="noun_X_1099163_3d3d38-Copy" transform="translate(313.000000, 0.000000)">
                                                            <path d="M5.22861077,6 L0.159759923,0.931149151 C-0.0532533077,0.718135894 -0.0532533077,0.37277318 0.159759923,0.159759923 C0.37277318,-0.0532533077 0.718135894,-0.0532533077 0.931149151,0.159759923 L6,5.22861077 L11.0688508,0.159759923 C11.2818641,-0.0532533077 11.6272268,-0.0532533077 11.8402401,0.159759923 C12.0532533,0.37277318 12.0532533,0.718135894 11.8402401,0.931149151 L6.77138923,6 L11.8402401,11.0688508 C12.0532533,11.2818641 12.0532533,11.6272268 11.8402401,11.8402401 C11.6272268,12.0532533 11.2818641,12.0532533 11.0688508,11.8402401 L6,6.77138923 L0.931149151,11.8402401 C0.718135894,12.0532533 0.37277318,12.0532533 0.159759923,11.8402401 C-0.0532533077,11.6272268 -0.0532533077,11.2818641 0.159759923,11.0688508 L5.22861077,6 Z" id="Path"></path>
                                                        </g>
                                                    </g>
                                                </g>
                                            </g>
                                        </svg>
                                        {% endcomment %}
                                        {{ 'cart_drawer.general.remove_txt' | t }}
                                    </span>
                                    
                                </div>
                            </div>
                            <div class="item_qty">
                                <div class="c-cart__itemQuantityBox ajaxcart__qty">
                                    <a href="#" rv-data-cart-update="index | plus 1" rv-data-cart-quantity="item.quantity | minus 1" class="ajaxcart__qty-adjust ajaxcart__qty--minus js-minus-product icon-fallback-text">
                                        <span class="c-drawer__minus">
                                            <svg width="10" height="2" xmlns="http://www.w3.org/2000/svg"><path d="M12.612 0H1.478C1.264 0 .8.308.8.925c0 .616.464.924.678.924h11.134c.214 0 .678-.308.678-.924 0-.617-.464-.925-.678-.925z" fill-rule="nonzero"/></svg>
                                        </span>
                                    </a>
                                    <span rv-text="item.quantity" class="ajaxcart__qty-num"></span>
                                    <a href="#" rv-data-cart-update="index | plus 1" rv-data-cart-quantity="item.quantity | plus 1" class="ajaxcart__qty-adjust ajaxcart__qty--plus icon-fallback-text">
                                        <span class="c-drawer__plus">
                                            <svg width="11" height="13" xmlns="http://www.w3.org/2000/svg"><path d="M11.485 5.163H6.974V.65c0-.205-.28-.651-.838-.651C5.578 0 5.3.446 5.3.651v4.512H.788c-.206 0-.652.279-.652.837 0 .558.446.837.652.837h4.511v4.512c0 .205.28.651.837.651.558 0 .838-.446.838-.651V6.837h4.511c.206 0 .651-.279.651-.837 0-.558-.445-.837-.65-.837z" fill-rule="nonzero"/></svg>
                                        </span>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div rv-show="cart.item_count | lt 1" class="c-cart__emptyText">
                    <span>{{ 'cart_drawer.general.empty_text' | t }}</span>
                </div>
                {% assign cartProduct = "" %}
                {% for item in cart.items %} 
                    {% assign cartProduct = cartProduct | append: "," | append: item.product_id  %}
                {% endfor %} 
                
                <div class="product_div">
                    <p class="fw-600 py-1 mb-0 related_product_title">{{ 'cart_drawer.general.related_title' | t }}</p>
                    <div class="prod_div_inner">
                    {% assign collection = collections[settings.collection_main] %}
                    {% for product in collection.products %}  
                        {% unless cartProduct contains product.id %}
                        {% assign upsell_current_variant = product.selected_or_first_available_variant | default: product.variants.first %}

                            <div class="product_main_div prod--{{ product.id }}">
                                <div class="img_div">
                                    <img class="lazyload" data-src="{{ product.featured_image | img_url: '200x' }}" width="97" height="97" alt="{{ product.title }}">
                                </div>
                                <div class="text_div">
                                    <div class="title_div">
                                        <p class="mb-0">{{ product.title }}</p>
                                    </div>
                                    <div class="price_div">
                                        <p class="mb-0">{{ product.price | money }}</p>
                                    </div>
                                    <div class="btn_div">
                                        <button data-cart-quantity="1" data-cart-add="{{ upsell_current_variant.id }}" data-cart-submit type="submit" class="button-all add-cart ml-auto" {% unless product.available %}disabled{% endunless %}>
                                            {% if product.available %}
                                                <span class="d-md-block d-none">{{ 'products.product.add_to_cart' | t }}</span>
                                                <span class="d-md-none d-block">{% include 'cart-bag' %}</span>
                                            {% endif %}
                                        </button>
                                    </div>
                                </div>  
                            </div>
                        {% endunless %}
                    {% endfor %}
                    </div>
                </div>
               
                <div class="c-drawer__subTotal">
                    <div class="c-drawer__subTotalRight">
                        <div class="cartCanvas__buttons" rv-show="cart.item_count | gt 0">
                            <button class="button-all w-100" type="submit" name="checkout" value="Check Out"><span class="c-cart__total c-drawer__subTotalPrice text-white" rv-data-total-price="cart.total_price | money_without_currency" rv-html="cart.items_subtotal_price | money Currency.currentCurrency" class="c-cart__itemPrice">
                            </span> &nbsp;| &nbsp;{{ 'cart_drawer.general.checkout_btn' | t }}</button>
                            <div class="additional-checkout-buttons">{{ content_for_additional_checkout_buttons }}</div>
                        </div>
                        <div class="note-bottom">
                            <p class="mb-0 text-center mt-3 display-4">{{ 'cart_drawer.general.discount_note' | t }}</p>
                        </div>
                    </div>
                </div>
            </div>
        </form>
        
    </div>
</div>

<script src="{{ 'offconvas.js' | asset_url }}"></script>
<script src="{{ 'rivets-cart.js' | asset_url }}"></script>
<script>
  // ---------------------------------------------------------------------------
    // Money format handler
    // ---------------------------------------------------------------------------
    Shopify.money_format = "${{amount}}";
    Shopify.formatMoney = function(cents, format) {
      if (typeof cents == 'string') { cents = cents.replace('.',''); }
      var value = '';
      var placeholderRegex = /\{\{\s*(\w+)\s*\}\}/;
      var formatString = (format || this.money_format);

      function defaultOption(opt, def) {
         return (typeof opt == 'undefined' ? def : opt);
      }

      function formatWithDelimiters(number, precision, thousands, decimal) {
        precision = defaultOption(precision, 2);
        thousands = defaultOption(thousands, ',');
        decimal   = defaultOption(decimal, '.');

        if (isNaN(number) || number == null) { return 0; }

        number = (number/100.0).toFixed(precision);

        var parts   = number.split('.'),
            dollars = parts[0].replace(/(\d)(?=(\d\d\d)+(?!\d))/g, '$1' + thousands),
            cents   = parts[1] ? (decimal + parts[1]) : '';

        return dollars + cents;
      }

      switch(formatString.match(placeholderRegex)[1]) {
        case 'amount':
          value = formatWithDelimiters(cents, 2);
          break;
        case 'amount_no_decimals':
          value = formatWithDelimiters(cents, 0);
          break;
        case 'amount_with_comma_separator':
          value = formatWithDelimiters(cents, 2, '.', ',');
          break;
        case 'amount_no_decimals_with_comma_separator':
          value = formatWithDelimiters(cents, 0, '.', ',');
          break;
      }

      return formatString.replace(placeholderRegex, value);
    }

  var cartDrawer = $(".js-cartCanvas").offcanvas({
        showOverlay: true
  });
  // Shopify Object To JavaScript Global Object
  var cartJSON = {{ cart | json }}, AddToCartClicked = false;

  // Initializing CartJS
  jQuery(function() {
    CartJS.init(cartJSON , {
      "dataAPI": true,
      "requestBodyClass": "loading",
      "moneyFormat": "{{ shop.money_format }}",
      "moneyWithCurrencyFormat": "{{ shop.money_with_currency_format }}"
    });
    rivets.bind($("[rv-value], #CartCount"), CartJS);
  });

</script>